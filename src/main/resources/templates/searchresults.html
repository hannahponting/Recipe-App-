<!DOCTYPE html>
<html  xmlns="http://www.w3.org/1999/xhtml"
       xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <link rel="stylesheet" type="text/css" href="/home.css">
</head>
<body>
    <h1 id="result-keyword-heading">Search results</h1>
    <script>
        let searchResultKeyword = window.location.search
        let searchResultKeywordResult = searchResultKeyword.replace(/.*=/, '');
        console.log(searchResultKeywordResult)
        let target = document.getElementById("result-keyword-heading");
        target.innerText = `Search results for "${searchResultKeywordResult}"`
    </script>


    <div class="search-container">
        <form action="http://localhost:8080/recipes/search" method="get">
            <label>
                <input class="search-input" name="keyword" type="text" placeholder="Search for recipes">
            </label>
            <button class="search-button" type="submit">Search</button>

        </form>


    </div>


    <div class="filter-containers">
        <form id=cuisine_typeform action="http://localhost:8080" method="get">
            <label for="cuisine">Cuisine:</label>
            <select id="cuisine" name="cuisine">
                <option value="FRENCH">French</option>
                <option value="ITALIAN">Italian</option>
                <option value="INDIAN">Indian</option>
                <option value="AMERICAN">American</option>
                <option value="INTERNATIONAL">International</option>
                <option value="MEDITERRANEAN">Mediterranean</option>
                <option value="MEXICAN">Mexican</option>
                <option value="ASIAN">Asian</option>
                <option value="BRITISH">British</option>
                <option value="THAI">Thai</option>
            </select>
            <form id="meal_typeform" action="http://localhost:8080" method="get">
                <label for="meal_type">Meal Type:</label>
                <select id="meal_type" name="meal_type">
                    <option value="BREAKFAST">Breakfast</option>
                    <option value="LUNCH">Lunch</option>
                    <option value="DINNER">Dinner</option>
                    <!-- Add more options as needed -->
                </select>
                <form id="spice_levelform" action="http://localhost:8080" method="get">
                    <label for="spice_level">Spicy Level:</label>
                    <select id="spice_level" name="spice_level">
                        <option value="NONE">None</option>
                        <option value="MILD">Mild</option>
                        <option value="MEDIUM">Medium</option>
                        <option value="SPICY">Spicy</option>
                    </select>
                    <form  id="difficultyform" action="http://localhost:8080" method="get">
                        <label for="difficulty">Difficult Level:</label>
                        <select id="difficulty" name="difficulty">
                            <option value="EASY">Easy</option>
                            <option value="MODERATE">Moderate</option>
                            <option value="HIGH">High</option>
                            <!-- Add more options as needed -->
                        </select>
                        <form id="costform" action="http://localhost:8080" method="get">
                            <label for="cost">Cost Level:</label>
                            <select id="cost" name="cost">
                                <option  value="LOW">Low</option>
                                <option  value="MODERATE">Moderate</option>
                                <option  value="PRICEY">Pricey</option>
                                <!-- Add more options as needed -->
                            </select>
                            <br > <button id ="apply-filters" type="button" onclick="myFunction()">Apply Filters</button> <br>
                        </form>
                    </form>
                </form>
            </form>

        </form>











        <script>
            function myFunction() {
                let costform = document.getElementById("cost")
                let costEnum = costform.options[costform.selectedIndex].value

                let difficultyform = document.getElementById("difficulty")
                let difficultyEnum = difficultyform.options[difficultyform.selectedIndex].value
                console.log(difficultyEnum)

                let spice_levelform = document.getElementById("spice_level")
                let spice_levelEnum = spice_levelform.options[spice_levelform.selectedIndex].value
                console.log(spice_levelEnum)

                let meal_typeform = document.getElementById("meal_type")
                let meal_typeEnum = meal_typeform.options[meal_typeform.selectedIndex].value
                console.log(meal_typeEnum)

                let cuisine_typeform = document.getElementById("cuisine")
                let cuisine_typeEnum = cuisine_typeform.options[cuisine_typeform.selectedIndex].value
                console.log(cuisine_typeEnum)

                fetch(`http://localhost:8080/api/recipes/cost/${costEnum}`)
                    .then(response => response.json())
                    .then(data => {

                        console.log(data.length);
                        console.log(data[0])
                        let newdata = data.filter(recipe => {
                            return recipe["difficulty_level"].includes(difficultyEnum) && recipe["spice_level"].includes(spice_levelEnum)
                                && recipe["mealType"].includes(meal_typeEnum) && recipe["cuisine"].includes(cuisine_typeEnum)
                        });
                        console.log(newdata.length)
                        console.log(newdata)


                        let target = document.getElementById('recipes')
                        target.innerHTML = "";
                        if (newdata.length === 0) {target.innerText = "No recipes for this filter combination found"
                        }
                        for (let i = 0; i < newdata.length; i++) {

                            let link = document.createElement("a")
                            link.href = `http://localhost:8080/recipes/${newdata[i].id}`
                            // console.log(data[i].name)

                            link.id =`item-link${newdata[i].name}`
                            target.appendChild(link)
                            let div = document.createElement("div");
                            div.className = "individual-items"
                            div.id = "specific-item"
                            div.innerHTML = newdata[i].name
                            let target2 = document.getElementById(`item-link${newdata[i].name}`)
                            target2.appendChild(div);
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching data:", error)
                    })


            }
        </script>





    </div>



    <div id="recipes" class="item-container">
    <script>

            let keyword = window.location.search
            let result = keyword.replace(/.*=/, '');
            console.log(result)

            fetch(`http://localhost:8080/api/recipes/search/name/${result}`)
                .then(response => response.json())
                .then(data => {
                    let recipesTarget = document.getElementById('recipes')

                    if (data.length > 0) {
                        console.log(data.length);
                        for (let i = 0; i < data.length; i++) {

                            let link = document.createElement("a")
                            link.href = `http://localhost:8080/recipes/${data[i].id}`
                            console.log(data[i].name)

                            link.id =`item-link${data[i].name}`
                            recipesTarget.appendChild(link)
                            let div = document.createElement("div");
                            div.className = "individual-items"
                            div.id = "specific-item"
                            div.innerHTML = data[i].name
                            let target2 = document.getElementById(`item-link${data[i].name}`)
                            target2.appendChild(div);
                        }

                    }

                    else
                    recipesTarget.innerText = "Sorry no items found for your search result"


                })
                .catch(error => {
                    console.error("Error fetching data:", error)

                })



    </script>


</div>
    </body>
</html>

